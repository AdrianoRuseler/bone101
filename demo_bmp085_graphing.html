<html> 
<head> 
 <title>Read an I2C pressure/temperature sensor</title>
 <script src="bonescript-demo.js" type="text/javascript"></script> 
 <script src="bonescript.js" type="text/javascript"></script> 
 <script src="processing.js" type="text/javascript"></script> 
 <script>
  setTimeout(startEditor, 1000);
  function startEditor() {
   demoEdit('code');
  }
 </script>
</head>
<body>
 <h1>Read an I2C pressure/temperature sensor</h1>
 <table><tr>
  <td width="800px">
   <div id="buttons"></div>
   <hr />
   <pre id="code">
var b = require('bonescript');
var i2c = '/sys/class/i2c-adapter/i2c-1/';

b.writeTextFile(i2c + 'new_device', 'bmp085 0x77');
setInterval(readTemp, 100);
function updateGraph(data) {
    graphDraw((parseInt(data.data, 10)/200.0)-0.7);
}
function readTemp() {
    b.readTextFile(i2c + '1-0077/temp0_input', updateGraph);    
}</pre>
   <hr />
  </td>
  <td width="400px">
   <canvas id="canvas1"></canvas>
  </td>
 </tr></table>
 <h2><a href="js_term.html">Now play with a free-form interpreter</a><h2>
		<script type="text/javascript">
			var canvas = document.getElementById("canvas1");
			var graphDataSize = 50;
			window.graphData = new Array(graphDataSize);
			for(var i=0; i<graphDataSize; i++) {
				window.graphData[i] = 0;
			}
			var processing = new Processing(canvas, sketchProc);

			function sketchProc(p) {
				p.size(400, 250);

				// variables referenced elsewhere
				window.height = p.height;

				// variables that might get updated
				window.rangeLow = 0;
				window.rangeHigh = 1;
				window.scaleY = window.height /
					(window.rangeHigh - window.rangeLow);

				// local variables
				var stepX = p.width / (graphDataSize - 1);
				var centerY = window.height / 2;

				p.noLoop();
				p.draw = function() {
					// erase background
					p.background(224);

					// draw axis
					p.stroke(25);
					p.strokeWeight(1);
					p.line(0, centerY, p.width, centerY);

					// draw graph
					p.stroke(0);
					p.strokeWeight(3);
					//p.line(0, centerY+1, p.width, centerY+1);
					var lastX = 0, nextX = 0, lastY, nextY;
					for(var point in window.graphData) {
						nextY = ((window.rangeHigh -
							window.graphData[point]) * scaleY);
						if(point != 0) {
							p.line(lastX, lastY, nextX, nextY);
							lastX += stepX;
						}
						nextX += stepX;
						lastY = nextY;
					}
				};
			}

			function graphDraw(data) {
				var myData = parseFloat(data);
				for(var i=0; i<graphDataSize-1; i++) {
					window.graphData[i] = window.graphData[i+1];
				}
				window.graphData[i] = myData;
				if (myData > rangeHigh) {
					rangeHigh = myData;
					window.scaleY = window.height /
						(window.rangeHigh - window.rangeLow);
				}
				if (myData < rangeLow) {
					rangeLow = myData;
					window.scaleY = window.height /
						(window.rangeHigh - window.rangeLow);
				}
				processing.redraw();
			}
		</script>
	</body>
</html>
